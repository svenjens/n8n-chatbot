<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChatGuus Widget Test - Servicerequest Pagina</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 20px;
        }
        .test-info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #2196f3;
        }
        .debug-panel {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            font-family: monospace;
            font-size: 14px;
        }
        .error {
            color: #d32f2f;
            background: #ffebee;
            border-left-color: #f44336;
        }
        .success {
            color: #388e3c;
            background: #e8f5e9;
            border-left-color: #4caf50;
        }
        .warning {
            color: #f57c00;
            background: #fff3e0;
            border-left-color: #ff9800;
        }
        button {
            background: #2196f3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #1976d2;
        }
    </style>
</head>
<body>
    <!-- Simuleer de /servicerequest URL -->
    <script>
        // Simuleer de juiste URL voor testing
        if (window.location.pathname !== '/servicerequest') {
            console.log('üîÑ Simulating /servicerequest path for testing');
            history.replaceState(null, '', '/servicerequest');
        }
    </script>

    <div class="container">
        <h1>üß™ ChatGuus Widget Integration Test</h1>
        
        <div class="test-info">
            <strong>Test Scenario:</strong> Loading ChatGuus widget on /servicerequest page
            <br><strong>Current Path:</strong> <code id="current-path"></code>
            <br><strong>Widget URL:</strong> <code>https://chatguuspt.netlify.app/.netlify/functions/widget</code>
        </div>

        <div id="debug-log" class="debug-panel">
            <strong>üìä Debug Log:</strong><br>
            <div id="log-content">Starting widget integration test...</div>
        </div>

        <div>
            <button onclick="testWidgetLoad()">üîÑ Test Widget Load</button>
            <button onclick="checkWidgetStatus()">üîç Check Widget Status</button>
            <button onclick="clearLog()">üóëÔ∏è Clear Log</button>
            <button onclick="simulateError()">‚ö†Ô∏è Simulate Error</button>
        </div>

        <h2>Service Request Pagina Content</h2>
        <p>Dit is de content van de /servicerequest pagina waar de ChatGuus widget zou moeten laden.</p>
        <p>De widget zou rechtsonder moeten verschijnen als een zwarte cirkel met een chat icoon.</p>
    </div>

    <!-- Je originele script maar met extra debugging -->
    <script>
        let debugLog = [];
        
        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            debugLog.push({message: logEntry, type});
            updateLogDisplay();
            console.log(logEntry);
        }
        
        function updateLogDisplay() {
            const logContent = document.getElementById('log-content');
            logContent.innerHTML = debugLog.map(entry => 
                `<div class="${entry.type}">${entry.message}</div>`
            ).join('');
        }
        
        function testWidgetLoad() {
            addLog('üöÄ Starting widget load test...', 'info');
            loadChatGuusWidget();
        }
        
        function checkWidgetStatus() {
            addLog('üîç Checking widget status...', 'info');
            
            // Check if widget script is loaded
            const widgetScript = document.querySelector('script[src*="widget"]');
            if (widgetScript) {
                addLog('‚úÖ Widget script element found in DOM', 'success');
            } else {
                addLog('‚ùå Widget script element not found in DOM', 'error');
            }
            
            // Check if ChatGuus global is available
            if (window.ChatGuus) {
                addLog('‚úÖ ChatGuus global object is available', 'success');
                addLog(`üìã ChatGuus methods: ${Object.keys(window.ChatGuus).join(', ')}`, 'info');
            } else {
                addLog('‚ùå ChatGuus global object not found', 'error');
            }
            
            // Check if widget elements exist in DOM
            const widgetElement = document.querySelector('.chatguus-widget');
            const toggleElement = document.querySelector('.chatguus-toggle');
            
            if (widgetElement) {
                addLog('‚úÖ Widget element found in DOM', 'success');
            } else {
                addLog('‚ùå Widget element not found in DOM', 'error');
            }
            
            if (toggleElement) {
                addLog('‚úÖ Toggle button found in DOM', 'success');
                const style = window.getComputedStyle(toggleElement);
                addLog(`üé® Toggle button color: ${style.backgroundColor}`, 'info');
            } else {
                addLog('‚ùå Toggle button not found in DOM', 'error');
            }
        }
        
        function clearLog() {
            debugLog = [];
            updateLogDisplay();
        }
        
        function simulateError() {
            addLog('‚ö†Ô∏è Simulating network error...', 'warning');
            // Simulate what happens when the widget fails to load
            window.onerror = function(msg, url, lineNo, columnNo, error) {
                addLog(`üí• JavaScript Error: ${msg} at ${url}:${lineNo}`, 'error');
                return false;
            };
        }
        
        // Update current path display
        document.getElementById('current-path').textContent = window.location.pathname;
        
        function loadChatGuusWidget() {
            addLog('üîç Checking current path...', 'info');
            
            // Laat de widget alleen op /servicerequest (met of zonder trailing slash) laden
            var path = window.location.pathname.toLowerCase().replace(/\/+$/,'');
            addLog(`üìç Current path: "${path}"`, 'info');
            
            if (path !== '/servicerequest') {
                addLog('‚ùå Path check failed - widget will not load', 'error');
                return;
            }
            
            addLog('‚úÖ Path check passed - loading widget script...', 'success');
            
            // Laad het script pas als we op de juiste pagina zijn
            var s = document.createElement('script');
            s.src = 'https://chatguuspt.netlify.app/.netlify/functions/widget';
            s.defer = true;
            
            s.onload = function () {
                addLog('‚úÖ Widget script loaded successfully', 'success');
                
                if (window.ChatGuus) {
                    addLog('‚úÖ ChatGuus object found - initializing...', 'success');
                    
                    try {
                        ChatGuus.init({
                            theme: 'koepel',
                            tenantId: 'mijn-bedrijf',
                            primaryColor: '#000000', // Zwart
                            position: 'bottom-right',
                            welcomeMessage: 'Wat kan ik voor je doen?'
                        });
                        addLog('üéâ ChatGuus initialized successfully!', 'success');
                        addLog('üé® Primary color set to: #000000 (black)', 'info');
                    } catch (error) {
                        addLog(`üí• Error initializing ChatGuus: ${error.message}`, 'error');
                    }
                } else {
                    addLog('‚ùå ChatGuus object not found after script load', 'error');
                }
            };
            
            s.onerror = function(error) {
                addLog('üí• Failed to load widget script', 'error');
                addLog(`Network error: ${error}`, 'error');
            };
            
            addLog('üì° Appending script to document body...', 'info');
            document.body.appendChild(s);
        }
        
        // Auto-load the widget when page loads
        document.addEventListener('DOMContentLoaded', function() {
            addLog('üåü Page loaded - starting automatic widget load...', 'info');
            setTimeout(loadChatGuusWidget, 1000); // Small delay to see the process
        });
        
        // Network error detection
        window.addEventListener('error', function(e) {
            if (e.target !== window) {
                addLog(`üåê Resource failed to load: ${e.target.src || e.target.href}`, 'error');
            }
        });
    </script>
</body>
</html>
