<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChatGuusPT - Netlify Integration Example</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            padding: 40px;
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            color: #1e293b;
        }
        
        h1 {
            color: #2563eb;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5rem;
        }
        
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .feature-card {
            background: #f8fafc;
            padding: 25px;
            border-radius: 12px;
            border-left: 4px solid #2563eb;
            transition: transform 0.2s ease;
        }
        
        .feature-card:hover {
            transform: translateY(-2px);
        }
        
        .feature-card h3 {
            color: #1e293b;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }
        
        .feature-card p {
            color: #64748b;
            margin: 0;
        }
        
        .demo-section {
            background: #f0f9ff;
            padding: 30px;
            border-radius: 12px;
            margin: 30px 0;
            border: 1px solid #bae6fd;
        }
        
        .demo-section h2 {
            color: #0369a1;
            margin-bottom: 20px;
        }
        
        .btn {
            background: #2563eb;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            margin: 10px 5px;
            transition: all 0.2s ease;
            text-decoration: none;
            display: inline-block;
        }
        
        .btn:hover {
            background: #1d4ed8;
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background: #64748b;
        }
        
        .btn-secondary:hover {
            background: #475569;
        }
        
        .code-block {
            background: #1e293b;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 14px;
            overflow-x: auto;
            margin: 15px 0;
        }
        
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .status-item {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            border: 2px solid #e2e8f0;
        }
        
        .status-item.online {
            border-color: #10b981;
        }
        
        .status-item.offline {
            border-color: #ef4444;
        }
        
        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        
        .dot-online {
            background: #10b981;
        }
        
        .dot-offline {
            background: #ef4444;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ ChatGuusPT op Netlify</h1>
        
        <div class="demo-section">
            <h2>üéØ Netlify Functions Demo</h2>
            <p>Deze pagina demonstreert ChatGuusPT draaiend op Netlify Functions - volledig serverless!</p>
            
            <div class="status-grid" id="status-grid">
                <div class="status-item" id="health-status">
                    <span class="status-dot dot-offline"></span>
                    <strong>Health Check</strong><br>
                    <span id="health-text">Checking...</span>
                </div>
                <div class="status-item" id="chat-status">
                    <span class="status-dot dot-offline"></span>
                    <strong>Chat Function</strong><br>
                    <span id="chat-text">Checking...</span>
                </div>
                <div class="status-item" id="widget-status">
                    <span class="status-dot dot-offline"></span>
                    <strong>Widget Serving</strong><br>
                    <span id="widget-text">Checking...</span>
                </div>
                <div class="status-item" id="tenant-status">
                    <span class="status-dot dot-offline"></span>
                    <strong>Multi-Tenant</strong><br>
                    <span id="tenant-text">Checking...</span>
                </div>
            </div>
            
            <div style="text-align: center; margin: 30px 0;">
                <button class="btn" onclick="openChat()">üí¨ Test Chat</button>
                <button class="btn btn-secondary" onclick="testServiceRequest()">üõ†Ô∏è Test Service</button>
                <button class="btn btn-secondary" onclick="testMultiTenant()">üè¢ Test Multi-Tenant</button>
                <a href="/admin/tenant-dashboard.html" class="btn btn-secondary" target="_blank">‚öôÔ∏è Tenant Dashboard</a>
            </div>
        </div>

        <div class="feature-grid">
            <div class="feature-card">
                <h3>‚ö° Serverless</h3>
                <p>Draait volledig op Netlify Functions - geen server onderhoud nodig!</p>
            </div>
            
            <div class="feature-card">
                <h3>üåç Global CDN</h3>
                <p>Widget wordt geserveerd via Netlify's wereldwijde CDN voor snelle laadtijden</p>
            </div>
            
            <div class="feature-card">
                <h3>üîÑ Auto-Scaling</h3>
                <p>Schaalt automatisch mee met je traffic - van 0 tot miljoenen requests</p>
            </div>
            
            <div class="feature-card">
                <h3>üí∞ Pay-per-Use</h3>
                <p>Betaal alleen voor daadwerkelijk gebruik - geen vaste server kosten</p>
            </div>
            
            <div class="feature-card">
                <h3>üîí Secure by Default</h3>
                <p>HTTPS, environment variables encryption, en automatic security updates</p>
            </div>
            
            <div class="feature-card">
                <h3>üöÄ Easy Deploy</h3>
                <p>Git push = automatische deployment met branch previews</p>
            </div>
        </div>

        <div class="demo-section">
            <h2>üîß Netlify Integration Code</h2>
            <p>Zo implementeer je ChatGuusPT op je Netlify-gehoste website:</p>
            
            <h3>1. Basis Implementatie</h3>
            <div class="code-block">
&lt;!-- Automatische Netlify detectie --&gt;
&lt;script src="/.netlify/functions/widget"&gt;&lt;/script&gt;
&lt;script&gt;
  ChatGuus.init({
    // Netlify Functions worden automatisch gedetecteerd
    theme: 'koepel'
  });
&lt;/script&gt;
            </div>

            <h3>2. Multi-Tenant Setup</h3>
            <div class="code-block">
&lt;!-- Voor verschillende organisaties --&gt;
&lt;script src="/.netlify/functions/widget?tenant=mijn-bedrijf"&gt;&lt;/script&gt;
&lt;script&gt;
  ChatGuus.init({
    tenantId: 'mijn-bedrijf',
    primaryColor: '#059669', // Custom branding
    welcomeMessage: 'Hello! How can I help you today?'
  });
&lt;/script&gt;
            </div>

            <h3>3. Custom Domain Setup</h3>
            <div class="code-block">
&lt;!-- Voor je eigen domain --&gt;
&lt;script src="https://chatbot.jouw-domain.nl/.netlify/functions/widget"&gt;&lt;/script&gt;
&lt;script&gt;
  ChatGuus.init({
    // Werkt automatisch met custom domains
  });
&lt;/script&gt;
            </div>
        </div>

        <div class="demo-section">
            <h2>üìä Netlify Voordelen</h2>
            
            <h3>‚úÖ Wat werkt perfect op Netlify:</h3>
            <ul style="margin: 15px 0 15px 20px;">
                <li><strong>Chat API:</strong> Volledig functioneel via Functions</li>
                <li><strong>OpenAI Integration:</strong> Werkt perfect serverless</li>
                <li><strong>Email Routing:</strong> Automatische doorverwijzing</li>
                <li><strong>Google Sheets:</strong> Logging en analytics</li>
                <li><strong>Multi-Tenant:</strong> White labeling voor meerdere klanten</li>
                <li><strong>Widget Serving:</strong> Dynamische widget generatie</li>
                <li><strong>CORS:</strong> Automatisch geconfigureerd</li>
                <li><strong>HTTPS:</strong> Gratis SSL certificaten</li>
            </ul>

            <h3>‚ö†Ô∏è Netlify Beperkingen:</h3>
            <ul style="margin: 15px 0 15px 20px;">
                <li><strong>Function Timeout:</strong> Max 10 seconden per request</li>
                <li><strong>Cold Starts:</strong> 1-2 seconden vertraging bij eerste request</li>
                <li><strong>Stateless:</strong> Geen persistent memory (gebruik externe session store)</li>
                <li><strong>No WebSockets:</strong> Alleen HTTP requests</li>
            </ul>

            <h3>üí° Best Practices voor Netlify:</h3>
            <ul style="margin: 15px 0 15px 20px;">
                <li>Gebruik caching voor widget serving</li>
                <li>Implementeer retry logic voor cold starts</li>
                <li>Optimaliseer OpenAI requests voor snelheid</li>
                <li>Monitor function execution times</li>
                <li>Gebruik environment variables voor configuratie</li>
            </ul>
        </div>
    </div>

    <!-- ChatGuusPT Widget - Auto-configured for Netlify -->
    <script>
        // Check if we're on Netlify
        const isNetlify = window.location.hostname.includes('netlify') || 
                         window.location.hostname.includes('localhost');
        
        if (isNetlify) {
            // Load widget from Netlify Functions
            const script = document.createElement('script');
            script.src = '/.netlify/functions/widget?tenant=koepel';
            script.onload = () => {
                if (window.ChatGuus) {
                    window.chatGuusInstance = ChatGuus.init({
                        theme: 'koepel',
                        welcomeMessage: 'üöÄ Hallo! Ik draai nu op Netlify Functions. Test me!'
                    });
                }
            };
            script.onerror = () => {
                console.error('Failed to load ChatGuus widget from Netlify Functions');
                showError('Widget kon niet geladen worden van Netlify Functions');
            };
            document.head.appendChild(script);
        } else {
            // Fallback for other environments
            const script = document.createElement('script');
            script.src = '/widget.js';
            script.onload = () => {
                if (window.ChatGuus) {
                    window.chatGuusInstance = ChatGuus.init();
                }
            };
            document.head.appendChild(script);
        }

        // Demo functions
        function openChat() {
            if (window.chatGuusInstance) {
                window.chatGuusInstance.open();
            } else {
                alert('Widget nog niet geladen, probeer over een paar seconden opnieuw');
            }
        }

        function testServiceRequest() {
            if (window.chatGuusInstance) {
                window.chatGuusInstance.open();
                setTimeout(() => {
                    window.chatGuusInstance.addMessage('Ik heb een IT probleem - mijn computer start niet op', 'user');
                }, 500);
            }
        }

        function testMultiTenant() {
            // Load demo company tenant
            const script = document.createElement('script');
            script.src = '/.netlify/functions/widget?tenant=demo-company';
            script.onload = () => {
                if (window.ChatGuus) {
                    const demoBot = ChatGuus.init({
                        target: '#demo-chat',
                        tenantId: 'demo-company',
                        primaryColor: '#059669',
                        welcomeMessage: 'Hello! I\'m the Demo Company assistant. How can I help?'
                    });
                    demoBot.open();
                }
            };
            document.head.appendChild(script);
            
            // Create demo chat container
            if (!document.getElementById('demo-chat')) {
                const demoContainer = document.createElement('div');
                demoContainer.id = 'demo-chat';
                document.body.appendChild(demoContainer);
            }
        }

        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #fef2f2;
                border: 1px solid #fecaca;
                color: #dc2626;
                padding: 15px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.1);
                z-index: 10000;
            `;
            errorDiv.textContent = message;
            document.body.appendChild(errorDiv);
            
            setTimeout(() => {
                document.body.removeChild(errorDiv);
            }, 5000);
        }

        // Status checking functions
        async function checkHealth() {
            try {
                const response = await fetch('/.netlify/functions/health');
                const data = await response.json();
                
                document.getElementById('health-text').textContent = `‚úÖ ${data.service}`;
                document.querySelector('#health-status .status-dot').className = 'status-dot dot-online';
                document.getElementById('health-status').className = 'status-item online';
                
                return data;
            } catch (error) {
                document.getElementById('health-text').textContent = '‚ùå Offline';
                return null;
            }
        }

        async function checkChatFunction() {
            try {
                const response = await fetch('/.netlify/functions/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        message: 'test',
                        sessionId: 'status-check-' + Date.now()
                    })
                });
                
                if (response.ok) {
                    document.getElementById('chat-text').textContent = '‚úÖ Functional';
                    document.querySelector('#chat-status .status-dot').className = 'status-dot dot-online';
                    document.getElementById('chat-status').className = 'status-item online';
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                document.getElementById('chat-text').textContent = `‚ùå ${error.message}`;
            }
        }

        async function checkWidgetServing() {
            try {
                const response = await fetch('/.netlify/functions/widget');
                
                if (response.ok && response.headers.get('content-type').includes('javascript')) {
                    document.getElementById('widget-text').textContent = '‚úÖ Serving';
                    document.querySelector('#widget-status .status-dot').className = 'status-dot dot-online';
                    document.getElementById('widget-status').className = 'status-item online';
                } else {
                    throw new Error('Invalid response');
                }
            } catch (error) {
                document.getElementById('widget-text').textContent = '‚ùå Failed';
            }
        }

        async function checkTenantAPI() {
            try {
                const response = await fetch('/.netlify/functions/tenants');
                const data = await response.json();
                
                document.getElementById('tenant-text').textContent = `‚úÖ ${data.tenants.length} tenants`;
                document.querySelector('#tenant-status .status-dot').className = 'status-dot dot-online';
                document.getElementById('tenant-status').className = 'status-item online';
            } catch (error) {
                document.getElementById('tenant-text').textContent = '‚ùå Failed';
            }
        }

        // Run status checks when page loads
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('üîç Running Netlify Functions status checks...');
            
            // Run all checks in parallel
            await Promise.all([
                checkHealth(),
                checkChatFunction(),
                checkWidgetServing(),
                checkTenantAPI()
            ]);
            
            console.log('‚úÖ Status checks completed');
        });
    </script>
</body>
</html>
